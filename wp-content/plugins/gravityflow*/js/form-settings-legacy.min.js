!function(k,m){"use strict";function b(t,i){var e=m("#gaddon-setting-tab-field-"+i+"_notification_type");(e.toggle(t),t)?(o(e.find("input[type=radio]:checked").val(),i),m("#gaddon-setting-tab-tab_"+i+"_notification i.gravityflow-tab-checked").show(),m("#gaddon-setting-tab-tab_"+i+"_notification i.gravityflow-tab-unchecked").hide()):(o("off",i),m("#gaddon-setting-tab-tab_"+i+"_notification i.gravityflow-tab-checked").hide(),m("#gaddon-setting-tab-tab_"+i+"_notification i.gravityflow-tab-unchecked").show())}function o(e,t){var i=["users","routing","from_name","from_email","reply_to","cc","bcc","subject","message","autoformat","resend","gpdf"],o="#gaddon-setting-tab-field-"+t+"_notification_";m.each(i,function(t,i){m(o+i).hide()}),"off"!=e&&m.each(i,function(t,i){if("users"==i&&"routing"==e||"routing"==i&&"select"==e)return!0;m(o+i).fadeToggle("normal")})}function v(t){i({select:["workflow_notification_users\\[\\]","workflow_notification_from_name","workflow_notification_from_email","workflow_notification_reply_to","workflow_notification_cc","workflow_notification_bcc","workflow_notification_subject","workflow_notification_message","workflow_notification_autoformat","workflow_email_custom_file_name","workflow_notification_gpdf"],routing:["workflow_notification_routing","workflow_notification_from_name","workflow_notification_from_email","workflow_notification_reply_to","workflow_notification_cc","workflow_notification_bcc","workflow_notification_subject","workflow_notification_message","workflow_notification_autoformat","workflow_email_custom_file_name","workflow_notification_gpdf"]},t,!1)}function h(t){i({select:["assignees\\[\\]","editable_fields\\[\\]","conditional_logic_editable_fields_enabled"],routing:["routing","conditional_logic_editable_fields_enabled"]},t)}function i(t,e,i){var o=i?"#gaddon-setting-tab-field-":"#gaddon-setting-row-";m.each(t,function(t,i){m.each(i,function(t,i){m(o+i).hide()})}),m.each(t,function(t,i){e==t&&m.each(i,function(t,i){m(o+i).fadeToggle("normal")})})}function y(t){var i=m("#gaddon-setting-row-workflow_notification_type");(i.toggle(t),t)?v(i.find("input[type=radio]:checked").val()):v("off")}m(document).ready(function(){m("#editable_fields, .gravityflow-multiselect-ui").multiSelect();var r={selectableHeader:"<input type='text' class='search-input' autocomplete='off' placeholder='"+gravityflow_form_settings_js_strings.assigneeSearchPlaceholder+"'>",selectionHeader:"<input type='text' class='search-input' autocomplete='off' placeholder='"+gravityflow_form_settings_js_strings.assigneeSearchPlaceholder+"'>",afterInit:function(t){var i=this,e=i.$selectableUl.prev(),o=i.$selectionUl.prev(),n="#"+t.attr("id")+" .ms-elem-selectable:not(.ms-selected)",a="#"+t.attr("id")+" .ms-elem-selection.ms-selected";10<m("#"+t.attr("id")+" .ms-elem-selectable").length&&m(".ms-container .search-input").show(),i.qs1=e.quicksearch(n).on("keydown",function(t){if(40===t.which)return i.$selectableUl.focus(),!1}),i.qs2=o.quicksearch(a).on("keydown",function(t){if(40==t.which)return i.$selectionUl.focus(),!1})},afterSelect:function(){this.qs1.cache(),this.qs2.cache()},afterDeselect:function(){this.qs1.cache(),this.qs2.cache()}};m("#assignees, #workflow_notification_users").multiSelect(r);var t=!1,i=!1;m("form#gform-settings").submit(function(){i=!0,m("form#gform-settings").find(":input").removeAttr("disabled")}),m(":input").change(function(){t=!0}),window.onbeforeunload=function(){if(t&&!i)return"You have unsaved changes."};m("input[name=_gaddon_setting_step_type]:checked").val();var e=m("#status_expiration"),o="expired"==e.val();m("#expiration_sub_setting_destination_expired").toggle(o),e.change(function(){"expired"==m(this).val()?m("#expiration_sub_setting_destination_expired").show():m("#expiration_sub_setting_destination_expired").hide()}),function(){for(var t=["routing","assignees\\[\\]","assignee_notification_from_name","assignee_notification_from_email","assignee_notification_reply_to","assignee_notification_cc","assignee_notification_bcc","assignee_notification_subject","assignee_notification_message","assignee_notification_autoformat","resend_assignee_email","assignee_notification_gpdf","rejection_notification_type","rejection_notification_users\\[\\]","rejection_notification_user_field","rejection_notification_routing","rejection_notification_message","rejection_notification_autoformat","approval_notification_type","approval_notification_users\\[\\]","approval_notification_user_field","approval_notification_routing","approval_notification_message","approval_notification_autoformat","workflow_notification_type","workflow_notification_users\\[\\]","workflow_notification_user_field","workflow_notification_routing","workflow_notification_from_name","workflow_notification_from_email","workflow_notification_reply_to","workflow_notification_cc","workflow_notification_bcc","workflow_notification_subject","workflow_notification_message","workflow_notification_autoformat","assignees\\[\\]","editable_fields\\[\\]","routing","assignee_notification_message","workflow_notification_gpdf"],i=0;i<t.length;i++)m("#gaddon-setting-row-"+t[i]).addClass("gravityflow_sub_setting")}(),h(m("input[name=_gaddon_setting_type]:checked").val()),m("#gaddon-setting-row-type input[type=radio]").change(function(){h(this.value)}),k.getUsersMarkup=function(t){var i,e,o,n=gf_routing_setting_strings.accounts,a='<select class="gform-routing-users '+t+'_{i}">';for(i=0;i<n.length;i++)if(void 0!==(o=n[i]).choices){var s,r="";for(e=0;e<o.choices.length;e++)s=o.choices[e],r+='<option value="{0}">{1}</option>'.format(s.value,s.label);a+='<optgroup label="{0}">{1}</option>'.format(o.label,r)}else a+='<option value="{0}">{1}</option>'.format(o.value,o.label);return a+="</select>"};var n,a=m("#gform_routing_setting"),s=m("#routing").val(),_=s?m.parseJSON(s):null;n=0<m("#editable_fields").length?(_||(_=[{assignee:gf_routing_setting_strings.accounts[0].choices[0].value,editable_fields:[gf_routing_setting_strings.input_fields[0].key],fieldId:"0",operator:"is",value:"",type:""}],m("#user_input_routing").val(m.toJSON(_))),{fieldName:a.data("field_name"),fieldId:a.data("field_id"),settings:gf_routing_setting_strings.fields,accounts:gf_routing_setting_strings.accounts,imagesURL:gf_vars.baseUrl+"/images",items:_,callbacks:{addNewTarget:function(t,i){var e=k.getUsersMarkup("assignee"),o=m("#editable_fields").clone();o.attr("name","editable_fields");m("#gform-routings tbody tr").length;return o.attr("id","editable_fields_routing_{i}"),o.attr("style",""),o.addClass("gform-routing-input-field editable_fields_{i}"),e+="</td><td>"+o[0].outerHTML},header:function(t,i){return'<thead><tr><th>Assign To</th><th>Editable Fields</th><th colspan="3">Condition</th></tr></thead>'}}}):(_||(_=[{assignee:gf_routing_setting_strings.accounts[0].choices[0].value,fieldId:"0",operator:"is",value:"",type:""}],m("#routing").val(m.toJSON(_))),{fieldName:a.data("field_name"),fieldId:a.data("field_id"),settings:gf_routing_setting_strings.fields,accounts:gf_routing_setting_strings.accounts,imagesURL:gf_vars.baseUrl+"/images",items:_,callbacks:{addNewTarget:function(t,i){return k.getUsersMarkup("assignee")}}}),a.gfRoutingSetting(n),m("#gaddon-setting-row-workflow_notification_type input[type=radio]").click(function(){v(this.value)}),y(m("#workflow_notification_enabled").prop("checked")),m("#workflow_notification_enabled").click(function(){y(this.checked)});var l=m("#gform_user_routing_setting_workflow_notification_routing"),f=m("#workflow_notification_routing").val(),c=f?m.parseJSON(f):null;c||(c=[{assignee:gf_routing_setting_strings.accounts[0].choices[0].value,fieldId:"0",operator:"is",value:"",type:""}],m("#workflow_notification_routing").val(m.toJSON(c)));var g={fieldName:l.data("field_name"),fieldId:l.data("field_id"),settings:gf_routing_setting_strings.fields,accounts:gf_routing_setting_strings.accounts,imagesURL:gf_vars.baseUrl+"/images",items:c,callbacks:{addNewTarget:function(t,i){return k.getUsersMarkup("assignee")}}};l.gfRoutingSetting(g),k.initNotificationTab=function(t){m("#"+t+"_notification_users").multiSelect(r);var i=m("#"+t+"_notification_enabled");b(i.prop("checked"),t),i.click(function(){b(this.checked,t)}),m("#gaddon-setting-tab-field-"+t+"_notification_type input[type=radio]").click(function(){b(!0,t)});var e=m("#gform_user_routing_setting_"+t+"_notification_routing");if(e.length){var o=m("#"+t+"_notification_routing"),n=o.val(),a=n?m.parseJSON(n):null;a||(a=[{assignee:gf_routing_setting_strings.accounts[0].choices[0].value,fieldId:"0",operator:"is",value:"",type:""}],o.val(m.toJSON(a)));var s={fieldName:e.data("field_name"),fieldId:e.data("field_id"),settings:gf_routing_setting_strings.fields,accounts:gf_routing_setting_strings.accounts,imagesURL:gf_vars.baseUrl+"/images",items:a,callbacks:{addNewTarget:function(t,i){return k.getUsersMarkup("assignee")}}};e.gfRoutingSetting(s)}};for(var d=["assignee","rejection","approval","in_progress","complete","revert"],u=0;u<d.length;u++)k.initNotificationTab(d[u]);var w=m("#default_status");"hidden"===w.val()&&m("#tabs-notification_tabs").tabs("disable",1),w.change(function(){var t="hidden"===m(this).val(),i=m("#tabs-notification_tabs");if(t){var e=m("#in_progress_notification_enabled");e.prop("checked")&&e.click(),1===i.tabs("option","active")&&i.tabs("option","active",0),i.tabs("disable",1)}else i.tabs("enable",1)});var p=m("#revertenable");p.prop("checked")||(m("#tabs-notification_tabs").tabs("disable",3),m("#gaddon-setting-row-reverted_message").hide()),p.change(function(){var t=m(this).prop("checked"),i=m("#tabs-notification_tabs");if(t)i.tabs("enable",3),m("#gaddon-setting-row-reverted_message").show();else{var e=m("#revert_notification_enabled");e.prop("checked")&&e.click(),1===i.tabs("option","active")&&i.tabs("option","active",0),i.tabs("disable",3),m("#gaddon-setting-row-reverted_message").hide()}}),window.gform&&gform.addFilter("gform_merge_tags",k.gravityflow_add_merge_tags),window.gformInitDatepicker&&gformInitDatepicker(),function(){var t=gravityflow_form_settings_js_strings.feedId;if(0<t){var i=ajaxurl+"?action=gravityflow_feed_message&fid="+t+"&id="+gravityflow_form_settings_js_strings.formId;m.get(i,function(t){var i=m("#save_button");i.before(t)})}}()}),k.gravityflow_add_merge_tags=function(t,i,e,o,n,a){return n||(function(t,i,e,o,n,a){if(["_gaddon_setting_workflow_notification_message","_gaddon_setting_assignee_notification_message","_gaddon_setting_approval_notification_message","_gaddon_setting_rejection_notification_message","_gaddon_setting_revert_notification_message","_gaddon_setting_complete_notification_message","_gaddon_setting_in_progress_notification_message"].indexOf(i)<0)return;var s=gravityflow_form_settings_js_strings.mergeTagLabels,r=[];r.push({tag:"{workflow_entry_link}",label:s.workflow_entry_link}),r.push({tag:"{workflow_entry_url}",label:s.workflow_entry_url}),r.push({tag:"{workflow_inbox_link}",label:s.workflow_inbox_link}),r.push({tag:"{workflow_inbox_url}",label:s.workflow_inbox_url}),r.push({tag:"{workflow_cancel_link}",label:s.workflow_cancel_link}),r.push({tag:"{workflow_cancel_url}",label:s.workflow_cancel_url}),r.push({tag:"{workflow_note}",label:s.workflow_note}),r.push({tag:"{workflow_timeline}",label:s.workflow_timeline}),r.push({tag:"{assignees}",label:s.assignees}),t.gravityflow={label:s.group,tags:r}}(t,i),function(t,i,e,o,n,a){if(["_gaddon_setting_assignee_notification_message"].indexOf(i)<0)return;var s=gravityflow_form_settings_js_strings.mergeTagLabels,r=[];r.push({tag:"{workflow_approve_link}",label:s.workflow_approve_link}),r.push({tag:"{workflow_approve_url}",label:s.workflow_approve_url}),r.push({tag:"{workflow_approve_token}",label:s.workflow_approve_token}),r.push({tag:"{workflow_reject_link}",label:s.workflow_reject_link}),r.push({tag:"{workflow_reject_url}",label:s.workflow_reject_url}),r.push({tag:"{workflow_reject_token}",label:s.workflow_reject_token}),m("#revertenable").prop("checked")&&(r.push({tag:"{workflow_revert_link}",label:s.workflow_revert_link}),r.push({tag:"{workflow_revert_url}",label:s.workflow_revert_url}),r.push({tag:"{workflow_revert_token}",label:s.workflow_revert_token}));void 0!==t.gravityflow?t.gravityflow.tags=m.merge(t.gravityflow.tags,r):t.gravityflow={label:s.group,tags:r}}(t,i)),t}}(window.GravityFlowFeedSettings=window.GravityFlowFeedSettings||{},jQuery);